webpackJsonp([1],{NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("7+uW"),r={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var s=n("VU/8")({name:"App"},r,!1,function(e){n("dMoB")},null,null).exports,c=n("/ocq"),i={name:"MyDesc",props:{val:{type:Array,default:function(){return[]}}}},o={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"desc_container"},[n("ul",{staticClass:"desc"},e._l(e.val,function(t){return n("li",{key:t.val,staticClass:"desc_item"},[n("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs"}]},[n("code",{class:t.type},[e._v(e._s(t.val))])])])}))])},staticRenderFns:[]};var u=n("VU/8")(i,o,!1,function(e){n("zy7m")},"data-v-59a1df10",null).exports,l=n("/Fbx"),d=n.n(l),v={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"my_header"},[t("router-link",{attrs:{to:"/"}},[t("div",{staticClass:"fa fa-home"})]),this._v(" "),t("router-link",{attrs:{to:"/create"}},[t("div",{staticClass:"fa fa-inbox"})])],1)},staticRenderFns:[]};var f=n("VU/8")({name:"MyHeader",methods:{goTo:function(e){return this.$router.push({name:e})}}},v,!1,function(e){n("ZS2S")},"data-v-24d445b9",null).exports,p={name:"Home",components:{MyDesc:u,MyHeader:f},data:function(){return{gradeLength:6}},computed:{subject:function(){return this.$store.state.subject},noSubject:function(){return 0===this.subject.desc.length},grades:function(){return this.$store.state.grades},gradeValArr:function(){return this.grades.map(function(e){return e.val})},stage:function(){return d()(this.gradeValArr)}},created:function(){this.$idb.getSubject()},methods:{clickGrade:function(e){var t=this;this.$idb.updateGrade(this.subject.key,parseInt(e)).then(function(){t.$idb.getSubject()})},goToCreate:function(){this.$router.push({name:"Create"})}}},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home_container"},[n("my-header"),n("div",{staticClass:"status"},[n("div",{staticClass:"bar"},e._l(e.gradeLength,function(t){return n("div",{staticClass:"grade_stage",class:"stage_"+(t-1),style:{width:(e.stage[t-1]||0)/e.gradeValArr.length*100+"%"}})}))]),n("div",{staticClass:"title"},[n("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs"}],key:e.subject.title.val},[n("code",{class:e.subject.title.type},[e._v(e._s(e.subject.title.val))])])]),n("my-desc",{attrs:{val:e.subject.desc}}),e.noSubject?e._e():n("div",{staticClass:"grade"},e._l(e.gradeLength,function(t){return n("div",{staticClass:"grade_item",class:{active:e.subject.grade===t-1},on:{click:function(n){e.clickGrade(t-1)}}},[e._v(e._s(t-1))])})),e.noSubject?n("div",{staticClass:"no_subject"},[n("span",[e._v(" Found No Subject,")]),n("span",{staticClass:"create_one",on:{click:e.goToCreate}},[e._v(" Create One")])]):e._e()],1)},staticRenderFns:[]};var g=n("VU/8")(p,m,!1,function(e){n("jZ0D")},"data-v-f303e2f6",null).exports,h=n("Xxa5"),b=n.n(h),j=n("Gu7T"),y=n.n(j),_=n("exGp"),w=n.n(_),C=n("Dd8w"),S=n.n(C),x={js:"javascript",plain:"plaintext",css:"css",md:"markdown",json:"json"},k={name:"Create",components:{MyHeader:f},data:function(){return{titleVal:"",titleType:x.plain,types:{},desc:[{type:x.plain,val:""}]}},created:function(){this.types=S()({},x)},mounted:function(){console.log("mounted")},methods:{addItem:function(){var e=this;return w()(b.a.mark(function t(){var n,a;return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n={title:{type:e.titleType,val:e.titleVal},desc:[].concat(y()(e.desc))},a=e.desc.filter(function(e){return e.val}).map(function(e){return{type:e.type,val:e.val}}),n.desc=[].concat(y()(a)),!n.title.val||!n.desc[0].val){t.next=8;break}return t.next=6,e.$idb.add(n);case 6:t.sent.target&&e.$router.push({name:"Home"});case 8:case"end":return t.stop()}},t,e)}))()},addDesc:function(){this.desc.push({type:x.plain,val:""})}}},D={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"create"},[n("my-header"),n("div",{staticClass:"title"},[n("select",{directives:[{name:"model",rawName:"v-model",value:e.titleType,expression:"titleType"}],on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.titleType=t.target.multiple?n:n[0]}}},e._l(e.types,function(t){return n("option",[e._v(e._s(t))])})),n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.titleVal,expression:"titleVal"}],attrs:{placeholder:"Title"},domProps:{value:e.titleVal},on:{input:function(t){t.target.composing||(e.titleVal=t.target.value)}}})]),n("div",{staticClass:"desc"},[e._l(e.desc,function(t){return n("div",{staticClass:"desc_item"},[n("select",{directives:[{name:"model",rawName:"v-model",value:t.type,expression:"item.type"}],on:{change:function(n){var a=Array.prototype.filter.call(n.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.$set(t,"type",n.target.multiple?a:a[0])}}},e._l(e.types,function(t){return n("option",[e._v(e._s(t))])})),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.val,expression:"item.val"}],attrs:{placeholder:"Desc"},domProps:{value:t.val},on:{input:function(n){n.target.composing||e.$set(t,"val",n.target.value)}}})])}),n("div",{staticClass:"add"},[n("div",{staticClass:"fa fa-plus",on:{click:e.addDesc}})])],2),n("div",{staticClass:"confirm",on:{click:e.addItem}},[e._m(0)])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"confirm_main"},[t("span",[this._v("Confirm")]),t("i",{staticClass:"fa fa-check"})])}]};var $=n("VU/8")(k,D,!1,function(e){n("z+5h")},"data-v-59b294be",null).exports;a.a.use(c.a);var I=new c.a({routes:[{path:"/",name:"Home",component:g},{path:"/create",name:"Create",component:$}]}),V=n("V8mf"),T=n.n(V),B=n("//Fk"),A=n.n(B),K=n("NYxO");a.a.use(K.a);var N,G=new K.a.Store({state:{subject:{title:{},desc:[]},grades:[]},mutations:{setSubject:function(e,t){e.subject=S()({},t)},setGrades:function(e,t){e.grades=[].concat(y()(t))}}});window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,window.indexedDB||window.alert("Your browser doesn't support a stable version of IndexedDB."),console.log("connect db");var E=window.indexedDB.open("bank",2);E.onerror=function(e){console.log("error: ")},E.onsuccess=function(e){N=E.result,console.log("success: "+N)},E.onupgradeneeded=function(e){var t=e.target.result,n=void 0;t.objectStoreNames.contains("subject")||(n=t.createObjectStore("subject",{autoIncrement:!0})),n.createIndex("grade","grade",{unique:!1});var a=void 0;t.objectStoreNames.contains("grade")||(a=t.createObjectStore("grade",{keyPath:"subjectKey"})),a.createIndex("grade","grade",{unique:!1})};var M=function(e){return new A.a(function(t,n){var a=N.transaction(["subject"],"readwrite").objectStore("subject").add(e);a.onsuccess=function(e){t(e)},a.onerror=function(e){n(e)}})},R=function(e,t){var n={subjectKey:e,val:t};return new A.a(function(t,a){var r=N.transaction(["grade"],"readwrite").objectStore("grade");r.get(e).onsuccess=function(e){e.target.result?r.put(n).onsuccess=function(e){t(e)}:r.add(n).onsuccess=function(e){t(e)}}})},F=function(){var e=N.transaction("subject").objectStore("subject");return new A.a(function(t,n){e.getAllKeys().onsuccess=function(e){var a=e.target.result;a&&a.length?N.transaction("grade").objectStore("grade").getAll().onsuccess=function(e){var n=e.target.result;G.commit("setGrades",n),n.forEach(function(e){for(var t=parseInt(e.val);t--;)a.push(parseInt(e.subjectKey))});var r,s,c=(r=0,s=a.length,Math.floor(Math.random()*(s-r))+r),i=a[c],o=n.find(function(e){return e.subjectKey===i});o=o?o.val:0,t({targetSubjectKey:i,targetSubjectGrade:o})}:n(new Error("No keys."))}})},H=function e(){N?F().then(function(e){!function(e,t){N.transaction("subject").objectStore("subject").get(e).onsuccess=function(n){var a=n.target.result;a&&(a.key=e,a.grade=t,G.commit("setSubject",a))}}(e.targetSubjectKey,e.targetSubjectGrade)}):setTimeout(function(){console.log("settimeout read"),e()},200)},U={install:function(e,t){console.log("idb install"),e.prototype.$idb={add:M,getSubject:H,updateGrade:R}}},q=U;n("lGVK");a.a.use(q),a.a.directive("highlightjs",{deep:!0,bind:function(e,t){e.querySelectorAll("code").forEach(function(e){t.value&&(e.textContent=t.value),T.a.highlightBlock(e)})},componentUpdated:function(e,t){e.querySelectorAll("code").forEach(function(e){t.value&&(e.textContent=t.value,T.a.highlightBlock(e))})}}),a.a.config.productionTip=!1,new a.a({el:"#app",router:I,components:{App:s},template:"<App/>",store:G})},ZS2S:function(e,t){},dMoB:function(e,t){},jZ0D:function(e,t){},lGVK:function(e,t){},"z+5h":function(e,t){},zy7m:function(e,t){}},["NHnr"]);