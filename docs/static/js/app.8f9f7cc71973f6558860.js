webpackJsonp([1],{"7xn4":function(e,t){},MbP4:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("7+uW"),r={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var s=n("VU/8")({name:"App"},r,!1,function(e){n("7xn4")},null,null).exports,c=n("/ocq"),o={name:"MyDesc",props:{val:{type:Array,default:function(){return[]}}}},i={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"desc_container"},[n("ul",{staticClass:"desc"},e._l(e.val,function(t){return n("li",{key:t.val,staticClass:"desc_item"},[n("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs"}]},[n("code",{class:t.type},[e._v(e._s(t.val))])])])}))])},staticRenderFns:[]};var u=n("VU/8")(o,i,!1,function(e){n("NM2J")},"data-v-59a1df10",null).exports,d=n("/Fbx"),l=n.n(d),g={name:"Home",components:{MyDesc:u},data:function(){return{gradeLength:6}},computed:{subject:function(){return this.$store.state.subject},grades:function(){return this.$store.state.grades},gradeValArr:function(){return this.grades.map(function(e){return e.val})},stage:function(){return l()(this.gradeValArr)}},created:function(){this.$idb.getSubject()},methods:{clickGrade:function(e){var t=this;this.$idb.updateGrade(this.subject.key,parseInt(e)).then(function(){t.$idb.getSubject()})},goToCreate:function(){this.$router.push({name:"Create"})}}},f={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home_container"},[n("div",{staticClass:"create",on:{click:e.goToCreate}},[e._v("create")]),n("div",{staticClass:"status"},[n("div",{staticClass:"bar"},e._l(e.gradeLength,function(t){return n("div",{staticClass:"grade_stage",class:"stage_"+(t-1),style:{width:(e.stage[t-1]||0)/e.gradeValArr.length*100+"%"}})}))]),n("div",{staticClass:"title"},[n("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs"}],key:e.subject.title.val},[n("code",{class:e.subject.title.type},[e._v(e._s(e.subject.title.val))])])]),n("my-desc",{attrs:{val:e.subject.desc}}),n("div",{staticClass:"grade"},e._l(e.gradeLength,function(t){return n("div",{staticClass:"grade_item",class:{active:e.subject.grade===t-1},on:{click:function(n){e.clickGrade(t-1)}}},[e._v(e._s(t-1))])}))],1)},staticRenderFns:[]};var v=n("VU/8")(g,f,!1,function(e){n("MbP4")},"data-v-7b8d8ca4",null).exports,h=n("Xxa5"),b=n.n(h),p=n("exGp"),m=n.n(p),j={name:"Create",mounted:function(){console.log("mounted")},methods:{addItem:function(){var e=this;return m()(b.a.mark(function t(){var n;return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$idb.add({title:{type:"plain",val:"test"},desc:[{type:"plain",val:"test"}]});case 2:n=t.sent,console.log(n);case 4:case"end":return t.stop()}},t,e)}))()}}},w={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"create"},[t("div",{staticClass:"click",on:{click:this.addItem}},[this._v("add")])])},staticRenderFns:[]},y=n("VU/8")(j,w,!1,null,null,null).exports;a.a.use(c.a);var _=new c.a({routes:[{path:"/",name:"Home",component:v},{path:"/create",name:"Create",component:y}]}),S=n("V8mf"),k=n.n(S),C=n("//Fk"),x=n.n(C),I=n("Gu7T"),D=n.n(I),B=n("Dd8w"),$=n.n(B),A=n("NYxO");a.a.use(A.a);var K,G=new A.a.Store({state:{subject:{title:{},desc:[]},grades:[]},mutations:{setSubject:function(e,t){e.subject=$()({},t)},setGrades:function(e,t){e.grades=[].concat(D()(t))}}});window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,window.indexedDB||window.alert("Your browser doesn't support a stable version of IndexedDB."),console.log("connect db");var N=window.indexedDB.open("bank",2);N.onerror=function(e){console.log("error: ")},N.onsuccess=function(e){K=N.result,console.log("success: "+K)},N.onupgradeneeded=function(e){var t=e.target.result,n=void 0;t.objectStoreNames.contains("subject")||(n=t.createObjectStore("subject",{autoIncrement:!0})),n.createIndex("grade","grade",{unique:!1});var a=void 0;t.objectStoreNames.contains("grade")||(a=t.createObjectStore("grade",{keyPath:"subjectKey"})),a.createIndex("grade","grade",{unique:!1})};var M=function(e){return new x.a(function(t,n){var a=K.transaction(["subject"],"readwrite").objectStore("subject").add(e);a.onsuccess=function(e){t(e)},a.onerror=function(e){n(e)}})},T=function(e,t){var n={subjectKey:e,val:t};return new x.a(function(t,a){var r=K.transaction(["grade"],"readwrite").objectStore("grade");r.get(e).onsuccess=function(e){e.target.result?r.put(n).onsuccess=function(e){t(e)}:r.add(n).onsuccess=function(e){t(e)}}})},E=function(){var e=K.transaction("subject").objectStore("subject");return new x.a(function(t,n){e.getAllKeys().onsuccess=function(e){var a=e.target.result;a&&a.length?K.transaction("grade").objectStore("grade").getAll().onsuccess=function(e){var n=e.target.result;G.commit("setGrades",n),n.forEach(function(e){for(var t=parseInt(e.val);t--;)a.push(parseInt(e.subjectKey))});var r,s,c=(r=0,s=a.length,Math.floor(Math.random()*(s-r))+r),o=a[c],i=n.find(function(e){return e.subjectKey===o});i=i?i.val:0,t({targetSubjectKey:o,targetSubjectGrade:i})}:n(new Error("No keys."))}})},R=function e(){K?E().then(function(e){!function(e,t){K.transaction("subject").objectStore("subject").get(e).onsuccess=function(n){var a=n.target.result;a&&(a.key=e,a.grade=t,G.commit("setSubject",a))}}(e.targetSubjectKey,e.targetSubjectGrade)}):setTimeout(function(){console.log("settimeout read"),e()},200)},V={install:function(e,t){console.log("idb install"),e.prototype.$idb={add:M,getSubject:R,updateGrade:T}}},F=V;a.a.use(F),a.a.directive("highlightjs",{deep:!0,bind:function(e,t){e.querySelectorAll("code").forEach(function(e){t.value&&(e.textContent=t.value),k.a.highlightBlock(e)})},componentUpdated:function(e,t){e.querySelectorAll("code").forEach(function(e){t.value&&(e.textContent=t.value,k.a.highlightBlock(e))})}}),a.a.config.productionTip=!1,new a.a({el:"#app",router:_,components:{App:s},template:"<App/>",store:G})},NM2J:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.8f9f7cc71973f6558860.js.map